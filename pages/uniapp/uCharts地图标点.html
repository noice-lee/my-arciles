<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>uCharts地图标点 | 不加冰</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/my-articles/assets/css/0.styles.e0f29ebb.css" as="style"><link rel="preload" href="/my-articles/assets/js/app.7e886d14.js" as="script"><link rel="preload" href="/my-articles/assets/js/2.36c4a625.js" as="script"><link rel="preload" href="/my-articles/assets/js/1.f0fd8913.js" as="script"><link rel="preload" href="/my-articles/assets/js/96.8a1fd4c7.js" as="script"><link rel="prefetch" href="/my-articles/assets/js/10.ec8af90e.js"><link rel="prefetch" href="/my-articles/assets/js/100.9763abad.js"><link rel="prefetch" href="/my-articles/assets/js/101.28133e6f.js"><link rel="prefetch" href="/my-articles/assets/js/11.8b5bf121.js"><link rel="prefetch" href="/my-articles/assets/js/12.5ce9305a.js"><link rel="prefetch" href="/my-articles/assets/js/13.fae9adaa.js"><link rel="prefetch" href="/my-articles/assets/js/14.b7d064e0.js"><link rel="prefetch" href="/my-articles/assets/js/15.d56c562f.js"><link rel="prefetch" href="/my-articles/assets/js/16.cc2d7a98.js"><link rel="prefetch" href="/my-articles/assets/js/17.c8324dac.js"><link rel="prefetch" href="/my-articles/assets/js/18.7f2ebe8d.js"><link rel="prefetch" href="/my-articles/assets/js/19.8b5552fa.js"><link rel="prefetch" href="/my-articles/assets/js/20.78575ebf.js"><link rel="prefetch" href="/my-articles/assets/js/21.e3494615.js"><link rel="prefetch" href="/my-articles/assets/js/22.0935f546.js"><link rel="prefetch" href="/my-articles/assets/js/23.a393dc8d.js"><link rel="prefetch" href="/my-articles/assets/js/24.9e4d2c5b.js"><link rel="prefetch" href="/my-articles/assets/js/25.c122fb1e.js"><link rel="prefetch" href="/my-articles/assets/js/26.f19fe819.js"><link rel="prefetch" href="/my-articles/assets/js/27.d0f3ce21.js"><link rel="prefetch" href="/my-articles/assets/js/28.ed96d0b3.js"><link rel="prefetch" href="/my-articles/assets/js/29.6baa698d.js"><link rel="prefetch" href="/my-articles/assets/js/3.a971e542.js"><link rel="prefetch" href="/my-articles/assets/js/30.bf7092f2.js"><link rel="prefetch" href="/my-articles/assets/js/31.b5b51dc7.js"><link rel="prefetch" href="/my-articles/assets/js/32.f9e00ba5.js"><link rel="prefetch" href="/my-articles/assets/js/33.c660147d.js"><link rel="prefetch" href="/my-articles/assets/js/34.81ee99cf.js"><link rel="prefetch" href="/my-articles/assets/js/35.0c94f01e.js"><link rel="prefetch" href="/my-articles/assets/js/36.aece8b12.js"><link rel="prefetch" href="/my-articles/assets/js/37.3b9feacb.js"><link rel="prefetch" href="/my-articles/assets/js/38.c7740d66.js"><link rel="prefetch" href="/my-articles/assets/js/39.5e19d596.js"><link rel="prefetch" href="/my-articles/assets/js/4.3c36bb7b.js"><link rel="prefetch" href="/my-articles/assets/js/40.99e1a50c.js"><link rel="prefetch" href="/my-articles/assets/js/41.27afea45.js"><link rel="prefetch" href="/my-articles/assets/js/42.8017cf57.js"><link rel="prefetch" href="/my-articles/assets/js/43.39d5bf55.js"><link rel="prefetch" href="/my-articles/assets/js/44.e7885be0.js"><link rel="prefetch" href="/my-articles/assets/js/45.46baee69.js"><link rel="prefetch" href="/my-articles/assets/js/46.f4221fa1.js"><link rel="prefetch" href="/my-articles/assets/js/47.a7711f06.js"><link rel="prefetch" href="/my-articles/assets/js/48.ded91f20.js"><link rel="prefetch" href="/my-articles/assets/js/49.a3a8dc0e.js"><link rel="prefetch" href="/my-articles/assets/js/5.8f74c542.js"><link rel="prefetch" href="/my-articles/assets/js/50.16d7130f.js"><link rel="prefetch" href="/my-articles/assets/js/51.fcba61e6.js"><link rel="prefetch" href="/my-articles/assets/js/52.78b3b900.js"><link rel="prefetch" href="/my-articles/assets/js/53.f0d3a285.js"><link rel="prefetch" href="/my-articles/assets/js/54.56d5860a.js"><link rel="prefetch" href="/my-articles/assets/js/55.e751ec5a.js"><link rel="prefetch" href="/my-articles/assets/js/56.db8866cb.js"><link rel="prefetch" href="/my-articles/assets/js/57.59eb2733.js"><link rel="prefetch" href="/my-articles/assets/js/58.5be72a73.js"><link rel="prefetch" href="/my-articles/assets/js/59.fe5d3e22.js"><link rel="prefetch" href="/my-articles/assets/js/6.db28458c.js"><link rel="prefetch" href="/my-articles/assets/js/60.ccc3d5e1.js"><link rel="prefetch" href="/my-articles/assets/js/61.f1388cea.js"><link rel="prefetch" href="/my-articles/assets/js/62.d8de1f9e.js"><link rel="prefetch" href="/my-articles/assets/js/63.ee3c54cd.js"><link rel="prefetch" href="/my-articles/assets/js/64.4ba3ddae.js"><link rel="prefetch" href="/my-articles/assets/js/65.1e85b0c4.js"><link rel="prefetch" href="/my-articles/assets/js/66.51ab0ada.js"><link rel="prefetch" href="/my-articles/assets/js/67.d62ea367.js"><link rel="prefetch" href="/my-articles/assets/js/68.15b10fd8.js"><link rel="prefetch" href="/my-articles/assets/js/69.33db3f4b.js"><link rel="prefetch" href="/my-articles/assets/js/7.1276edb2.js"><link rel="prefetch" href="/my-articles/assets/js/70.5cfea755.js"><link rel="prefetch" href="/my-articles/assets/js/71.323f476f.js"><link rel="prefetch" href="/my-articles/assets/js/72.60a6675e.js"><link rel="prefetch" href="/my-articles/assets/js/73.bfdd1b1b.js"><link rel="prefetch" href="/my-articles/assets/js/74.70cc6d02.js"><link rel="prefetch" href="/my-articles/assets/js/75.e2f21574.js"><link rel="prefetch" href="/my-articles/assets/js/76.015a181a.js"><link rel="prefetch" href="/my-articles/assets/js/77.3533f442.js"><link rel="prefetch" href="/my-articles/assets/js/78.f10455f7.js"><link rel="prefetch" href="/my-articles/assets/js/79.62525916.js"><link rel="prefetch" href="/my-articles/assets/js/80.08310015.js"><link rel="prefetch" href="/my-articles/assets/js/81.0f7687e2.js"><link rel="prefetch" href="/my-articles/assets/js/82.1736d0a6.js"><link rel="prefetch" href="/my-articles/assets/js/83.ba3ca1ff.js"><link rel="prefetch" href="/my-articles/assets/js/84.32f225f7.js"><link rel="prefetch" href="/my-articles/assets/js/85.d8d0f779.js"><link rel="prefetch" href="/my-articles/assets/js/86.700cfa6d.js"><link rel="prefetch" href="/my-articles/assets/js/87.1ec1aee6.js"><link rel="prefetch" href="/my-articles/assets/js/88.85d86ff5.js"><link rel="prefetch" href="/my-articles/assets/js/89.37a2e54b.js"><link rel="prefetch" href="/my-articles/assets/js/90.d1bf171a.js"><link rel="prefetch" href="/my-articles/assets/js/91.1425d1bc.js"><link rel="prefetch" href="/my-articles/assets/js/92.d1744e24.js"><link rel="prefetch" href="/my-articles/assets/js/93.9d44669f.js"><link rel="prefetch" href="/my-articles/assets/js/94.0feeeff9.js"><link rel="prefetch" href="/my-articles/assets/js/95.670e0c15.js"><link rel="prefetch" href="/my-articles/assets/js/97.819efebb.js"><link rel="prefetch" href="/my-articles/assets/js/98.d142a726.js"><link rel="prefetch" href="/my-articles/assets/js/99.e9b50ff3.js"><link rel="prefetch" href="/my-articles/assets/js/vendors~docsearch.4f1414c9.js">
    <link rel="stylesheet" href="/my-articles/assets/css/0.styles.e0f29ebb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-articles/" class="home-link router-link-active"><img src="/my-articles/2022-03-24_115321.png" alt="不加冰" class="logo"> <span class="site-name can-hide">不加冰</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-articles/pages/leetcode/easy/001.两数之和.html" class="nav-link">
  力扣算法
</a></div><div class="nav-item"><a href="/my-articles/pages/studyNote/尚硅谷React.html" class="nav-link">
  学习笔记
</a></div><div class="nav-item"><a href="/my-articles/pages/data/队列结构.html" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/my-articles/pages/engineering/引入ESLint、Prettier、pre-commit.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/my-articles/pages/vue/插槽、组件.html" class="nav-link">
  Vue学习
</a></div><div class="nav-item"><a href="/my-articles/pages/uniapp/uCharts地图标点.html" class="nav-link">
  uniapp
</a></div><div class="nav-item"><a href="/my-articles/pages/notes/01-2022年6月记.html" class="nav-link">
  随心记
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-articles/pages/leetcode/easy/001.两数之和.html" class="nav-link">
  力扣算法
</a></div><div class="nav-item"><a href="/my-articles/pages/studyNote/尚硅谷React.html" class="nav-link">
  学习笔记
</a></div><div class="nav-item"><a href="/my-articles/pages/data/队列结构.html" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/my-articles/pages/engineering/引入ESLint、Prettier、pre-commit.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/my-articles/pages/vue/插槽、组件.html" class="nav-link">
  Vue学习
</a></div><div class="nav-item"><a href="/my-articles/pages/uniapp/uCharts地图标点.html" class="nav-link">
  uniapp
</a></div><div class="nav-item"><a href="/my-articles/pages/notes/01-2022年6月记.html" class="nav-link">
  随心记
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/my-articles/pages/uniapp/uCharts地图标点.html" class="active sidebar-link">uCharts地图标点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-articles/pages/uniapp/uCharts地图标点.html#效果图" class="sidebar-link">效果图</a></li><li class="sidebar-sub-header"><a href="/my-articles/pages/uniapp/uCharts地图标点.html#通过经纬度标点" class="sidebar-link">通过经纬度标点</a></li><li class="sidebar-sub-header"><a href="/my-articles/pages/uniapp/uCharts地图标点.html#省份对应的数量标点" class="sidebar-link">省份对应的数量标点</a></li></ul></li><li><a href="/my-articles/pages/uniapp/编译安卓之webview.html" class="sidebar-link">编译安卓之webview</a></li><li><a href="/my-articles/pages/uniapp/解决uni-datetime-picker选择时间长度.html" class="sidebar-link">uni-datetime-picker选择时间长度</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ucharts地图标点"><a href="#ucharts地图标点" class="header-anchor">#</a> uCharts地图标点</h1> <blockquote><p><code>uCharts</code>是一款基于<code>canvas API</code>开发的适用于所有前端应用的图表库，开发者编写一套代码，可运行到 Web、iOS、Android（基于 uni-app / taro ）、以及各种小程序（微信/支付宝/百度/头条/飞书/QQ/快手/钉钉/淘宝/京东/360）、快应用等更多支持 canvas API 的平台。</p></blockquote> <p>本文介绍<code>uCharts</code>地图实现标点，以组件的方式实现，任何问题欢迎沟通交流。</p> <h2 id="效果图"><a href="#效果图" class="header-anchor">#</a> 效果图</h2> <p><strong>图一是直接给经纬度标点，图二是显示当前省份下对应的数量</strong></p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d328c07db3814a3b9e6326e80e165d24~tplv-k3u1fbpfcp-watermark.image?" alt="2022-06-24_172204.jpg"></p> <h2 id="通过经纬度标点"><a href="#通过经纬度标点" class="header-anchor">#</a> 通过经纬度标点</h2> <h3 id="_1-组件传入数据"><a href="#_1-组件传入数据" class="header-anchor">#</a> 1. 组件传入数据</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>qiun-data-charts</span> 
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:opts</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>opts<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:chartData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chartData<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:reload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reload<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
        
opts = {
     ……
    // 通过添加一个任意一个不和已有属性重名的属性, 将经纬度及其他可能用到的数据传入
    location: [
        {
            coordinate: ['经纬度坐标'],
            count: '',
        }
    ]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_2-找对应ucharts的源码"><a href="#_2-找对应ucharts的源码" class="header-anchor">#</a> 2. 找对应ucharts的源码</h3> <ul><li><p>打开文件 <code>/uni_modules/qiun-data-charts/js_sdk/u-charts/u-charts.js</code></p></li> <li><p><code>drawMapDataPoints</code> 函数即绘制地图的函数</p></li></ul> <h3 id="_3-开始绘制"><a href="#_3-开始绘制" class="header-anchor">#</a> 3. 开始绘制</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 利用ucharts封装好的方法进行坐标转换</span>
<span class="token keyword">function</span> <span class="token function">drawMapDataPoints</span><span class="token punctuation">(</span><span class="token parameter">series<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> config<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 源码中部分代码</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> series<span class="token punctuation">;</span>
    <span class="token keyword">var</span> bounds <span class="token operator">=</span> <span class="token function">getBoundingBox</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> xScale <span class="token operator">=</span> opts<span class="token punctuation">.</span>width <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>bounds<span class="token punctuation">.</span>xMax <span class="token operator">-</span> bounds<span class="token punctuation">.</span>xMin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> yScale <span class="token operator">=</span> opts<span class="token punctuation">.</span>height <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>bounds<span class="token punctuation">.</span>yMax <span class="token operator">-</span> bounds<span class="token punctuation">.</span>yMin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> scale <span class="token operator">=</span> xScale <span class="token operator">&lt;</span> yScale <span class="token operator">?</span> xScale <span class="token operator">:</span> yScale<span class="token punctuation">;</span>
    <span class="token keyword">var</span> xoffset <span class="token operator">=</span> opts<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>bounds<span class="token punctuation">.</span>xMax <span class="token operator">-</span> bounds<span class="token punctuation">.</span>xMin<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">var</span> yoffset <span class="token operator">=</span> opts<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>bounds<span class="token punctuation">.</span>yMax <span class="token operator">-</span> bounds<span class="token punctuation">.</span>yMin<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    
    <span class="token comment">// 获取经纬度及其他数据的数组</span>
    <span class="token keyword">const</span> location <span class="token operator">=</span> opts<span class="token punctuation">.</span>location
    location<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 经纬度转墨卡托坐标</span>
        <span class="token keyword">const</span> mercator <span class="token operator">=</span>  <span class="token function">lonlat2mercator</span><span class="token punctuation">(</span><span class="token string">'经度'</span><span class="token punctuation">,</span> <span class="token string">'纬度'</span><span class="token punctuation">)</span>
        <span class="token comment">// 转换为当前经纬对应canvas画布上的坐标</span>
        <span class="token keyword">const</span> point <span class="token operator">=</span> <span class="token function">coordinateToPoint</span><span class="token punctuation">(</span>mercator<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mercator<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bounds<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> xoffset<span class="token punctuation">,</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绘制白点</span>
        context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>x<span class="token punctuation">,</span> point<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'transparent'</span>
        context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'white'</span>
        context<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        context<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绘制标记icon</span>
        context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>x<span class="token punctuation">,</span> point<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>x<span class="token punctuation">,</span> point<span class="token punctuation">.</span>y <span class="token operator">-</span> fontSize <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> fontSize <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">45</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">135</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>x<span class="token punctuation">,</span> point<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#B9AF57'</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="省份对应的数量标点"><a href="#省份对应的数量标点" class="header-anchor">#</a> 省份对应的数量标点</h2> <h3 id="_1-组件传入数据-2"><a href="#_1-组件传入数据-2" class="header-anchor">#</a> 1. 组件传入数据</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>qiun-data-charts</span> 
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:opts</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>opts<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
​
// 需注意: 省份名称需处理为地图上显示的字样
opts.data = {
    '内蒙古': 1,
    '山西': 1,
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-找对应ucharts的源码-2"><a href="#_2-找对应ucharts的源码-2" class="header-anchor">#</a> 2. 找对应ucharts的源码</h3> <p>源码大致位置同上，再往下看找到如下代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>dataLabel <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 循环绘制省份名称</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> centerPoint <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>centroid<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>centerPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 准备在此处修改代码</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-开始绘制-2"><a href="#_3-开始绘制-2" class="header-anchor">#</a> 3. 开始绘制</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 记录该省的数量</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> opts<span class="token punctuation">.</span>data<span class="token punctuation">[</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>name<span class="token punctuation">]</span>
​
<span class="token comment">// 绘制省份名称</span>
point <span class="token operator">=</span> <span class="token function">coordinateToPoint</span><span class="token punctuation">(</span>centerPoint<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> centerPoint<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bounds<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> xoffset<span class="token punctuation">,</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">'left'</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">setFontSize</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">)</span>
context<span class="token punctuation">.</span><span class="token function">setFillStyle</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>textColor <span class="token operator">||</span> opts<span class="token punctuation">.</span>fontColor<span class="token punctuation">)</span>
<span class="token comment">// 记录省份名称x轴位置</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> point<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token function">measureText</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> fontSize<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token comment">// 如果该省份有数量，就将x位置偏移一点</span>
context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token operator">!</span>count <span class="token operator">?</span> x <span class="token operator">:</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> fontSize <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> point<span class="token punctuation">.</span>y <span class="token operator">+</span> fontSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 省份绘制完成</span>
​
<span class="token comment">// 如果有数量 开始绘制</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 定义省份名称前面的圆点的中心 后续绘制以此为原点进行计算</span>
    <span class="token keyword">const</span> centerx <span class="token operator">=</span> point<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token function">measureText</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> fontSize<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token keyword">const</span> centery <span class="token operator">=</span> point<span class="token punctuation">.</span>y <span class="token operator">+</span> fontSize <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token comment">// 绘制icon背景</span>
    context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>centerx<span class="token punctuation">,</span> centery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>centerx<span class="token punctuation">,</span> centery <span class="token operator">-</span> fontSize <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> fontSize <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">45</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">135</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>centerx<span class="token punctuation">,</span> centery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#B9AF57'</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
​
    <span class="token comment">// 绘制icon上的数量</span>
    context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">'center'</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">setFontSize</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">)</span>
    context<span class="token punctuation">.</span><span class="token function">setFillStyle</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>textColor <span class="token operator">||</span> opts<span class="token punctuation">.</span>fontColor<span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#FFFFFF'</span>
    <span class="token comment">// 因为icon大小是固定的，数量太大样式会有问题，如果太多的话显示 99+</span>
    context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token operator">?</span> count <span class="token operator">:</span> <span class="token string">'99+'</span><span class="token punctuation">,</span> centerx<span class="token punctuation">,</span> centery <span class="token operator">-</span> fontSize <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
    
    <span class="token comment">// 绘制白色圆点</span>
    context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>centerx<span class="token punctuation">,</span> centery<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'transparent'</span>
    context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'white'</span>
    context<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h4 id="随心记"><a href="#随心记" class="header-anchor">#</a> 随心记</h4> <blockquote><p>一开始用<code>uCharts</code>是在写一个<code>uniapp</code>编译微信小程序的项目时，用<code>eCharts</code>实现不出来对应效果，就去网上找另外插件，看到了这个，刚开始的时候这个插件还是免费的，就将这个插件用到项目里面了。过了一段时间又有一个<code>uniapp</code>项目用到了图表，就又想到了这个，但是一看文档发现这个开始收费了，看了下<code>uniapp</code>插件市场下的评论，都是在表达对这插件的不满。不过想来收费应该可以带来的是后续的维护，还是开了一个会员；当时还是看到活动期间开通会员次月可全部返还才开的，不过进了会员群之后听讨论才注意到是有些条件的，还是大意了。用了几次之后有技术问题就在会员群里进行提问，群主还是很上心地进行答疑，告知了些修改源码的思路；通过这几次的修改，了解到了一些平时没用到的技术和思想还是很开心的，现在想来会员开的还是值的。</p></blockquote> <p><a href="https://www.ucharts.cn/v2/#/" target="_blank" rel="noopener noreferrer">ucharts官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/12/14 09:39</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/my-articles/pages/uniapp/编译安卓之webview.html">
        编译安卓之webview
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/my-articles/assets/js/app.7e886d14.js" defer></script><script src="/my-articles/assets/js/2.36c4a625.js" defer></script><script src="/my-articles/assets/js/1.f0fd8913.js" defer></script><script src="/my-articles/assets/js/96.8a1fd4c7.js" defer></script>
  </body>
</html>
